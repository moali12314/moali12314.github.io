<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Soul Knight - Персонаж</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; overflow: hidden; position: fixed; background: #000; }
        body { display: flex; justify-content: center; align-items: center; }
        canvas { display: block; width: 100%; height: 100%; object-fit: fill; }
        @media (max-width: 768px) and (orientation: portrait) {
            body::before {
                content: "ПОВЕРНИТЕ ЭКРАН"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: #000; color: white; font-size: 24px; display: flex; align-items: center;
                justify-content: center; z-index: 9999;
            }
            canvas { display: none; }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        (function() {
            if (window.Telegram?.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            }

            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // ============================================
            // *** ВСТАВЬТЕ СЮДА ПРЯМЫЕ ССЫЛКИ НА ИЗОБРАЖЕНИЯ ***
            // ============================================
            const IMAGES = {
                idle: 'https://yapx.ru/album/c7jJo',     // Ссылка на базовую позу
                run1: 'https://yapx.ru/album/c7jJo',     // Ссылка на бег 1
                run2: 'https://yapx.ru/album/c7jJo',     // Ссылка на бег 2
                run3: 'https://yapx.ru/album/c7jJo'      // Ссылка на бег 3
            };
            // ============================================

            // Размеры
            const WORLD_SIZE = 600;
            const PLAYER_SIZE = 48;
            
            let player = { x: 276, y: 276, vx: 0, vy: 0, speed: 2.5 };
            let keys = {};
            let isMoving = false;
            
            // Анимация
            let animFrame = 0;
            let frameCount = 0;
            const ANIM_SPEED = 6;

            // Загрузка изображений
            const images = {
                idle: new Image(),
                run: [new Image(), new Image(), new Image()]
            };
            
            images.idle.src = IMAGES.idle;
            images.run[0].src = IMAGES.run1;
            images.run[1].src = IMAGES.run2;
            images.run[2].src = IMAGES.run3;

            // Управление
            document.addEventListener('keydown', (e) => { keys[e.key.toLowerCase()] = true; e.preventDefault(); });
            document.addEventListener('keyup', (e) => { keys[e.key.toLowerCase()] = false; });
            
            // Ресайз
            function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
            window.addEventListener('resize', resize);
            resize();

            function update() {
                // Движение
                let dx = 0, dy = 0;
                if (keys['a'] || keys['left']) dx = -1;
                if (keys['d'] || keys['right']) dx = 1;
                if (keys['w'] || keys['up']) dy = -1;
                if (keys['s'] || keys['down']) dy = 1;

                if (dx !== 0 || dy !== 0) {
                    player.vx = dx * player.speed;
                    player.vy = dy * player.speed;
                    isMoving = true;
                } else {
                    player.vx *= 0.8; player.vy *= 0.8;
                    if (Math.abs(player.vx) < 0.1) player.vx = 0;
                    if (Math.abs(player.vy) < 0.1) player.vy = 0;
                    isMoving = false;
                }

                player.x += player.vx;
                player.y += player.vy;
                player.x = Math.max(0, Math.min(WORLD_SIZE - PLAYER_SIZE, player.x));
                player.y = Math.max(0, Math.min(WORLD_SIZE - PLAYER_SIZE, player.y));

                // Кадр анимации
                if (isMoving) {
                    frameCount++;
                    if (frameCount >= ANIM_SPEED) {
                        frameCount = 0;
                        animFrame = (animFrame + 1) % 3;
                    }
                } else {
                    animFrame = 0;
                }

                // Отрисовка
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                ctx.translate((canvas.width - WORLD_SIZE) / 2, (canvas.height - WORLD_SIZE) / 2);
                
                // Фон
                ctx.fillStyle = '#2a2f3e';
                ctx.fillRect(0, 0, WORLD_SIZE, WORLD_SIZE);
                
                // Сетка
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                for (let i = 0; i <= WORLD_SIZE; i += 40) {
                    ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, WORLD_SIZE); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(WORLD_SIZE, i); ctx.stroke();
                }

                // Персонаж
                let img = isMoving ? images.run[animFrame] : images.idle;
                if (img && img.complete && img.naturalHeight > 0) {
                    ctx.drawImage(img, player.x, player.y, PLAYER_SIZE, PLAYER_SIZE);
                } else {
                    ctx.fillStyle = isMoving ? '#44ff44' : '#4444ff';
                    ctx.fillRect(player.x, player.y, PLAYER_SIZE, PLAYER_SIZE);
                }

                ctx.restore();
                requestAnimationFrame(update);
            }
            
            update();
        })();
    </script>
</body>
</html>
