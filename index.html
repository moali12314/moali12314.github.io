<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Soul Knight - Боец</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            background: #000;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: pan-y pinch-zoom;
        }

        @media (max-width: 768px) and (orientation: portrait) {
            body::before {
                content: "ПОВЕРНИТЕ ЭКРАН";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #000;
                color: white;
                font-size: 24px;
                font-weight: bold;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                z-index: 9999;
                font-family: Arial, sans-serif;
                letter-spacing: 2px;
            }
            canvas {
                display: none !important;
            }
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: fill;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        (function() {
            // Telegram
            if (window.Telegram?.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            }

            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // Размеры мира
            const WORLD_SIZE = 600; // Простой квадратный мир
            
            // Размеры персонажа
            const PLAYER_SIZE = 40;
            
            let player = {
                x: 250,
                y: 250,
                vx: 0,
                vy: 0,
                speed: 3
            };

            // ВСТАВЬТЕ СВОИ КАРТИНКИ СЮДА (в формате base64 или замените пути)
            // ============================================
            const IDLE_IMG = 'baserun.png';      // Стоячий
            const RUN1_IMG = 'run1.png';          // Бег 1
            const RUN2_IMG = 'run2.png';          // Бег 2
            const RUN3_IMG = 'run3.png';          // Бег 3
            // ============================================

            // Загружаем картинки
            const images = {
                idle: new Image(),
                run: [new Image(), new Image(), new Image()]
            };
            
            images.idle.src = IDLE_IMG;
            images.run[0].src = RUN1_IMG;
            images.run[1].src = RUN2_IMG;
            images.run[2].src = RUN3_IMG;

            // Анимация
            let animFrame = 0;
            let frameCount = 0;
            let isMoving = false;

            // Управление
            const keys = {};

            document.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
                e.preventDefault();
            });

            document.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });

            // Размер canvas под экран
            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            window.addEventListener('resize', resize);
            resize();

            // Игровой цикл
            function update() {
                // Движение
                let dx = 0, dy = 0;
                if (keys['a'] || keys['left']) dx = -1;
                if (keys['d'] || keys['right']) dx = 1;
                if (keys['w'] || keys['up']) dy = -1;
                if (keys['s'] || keys['down']) dy = 1;

                if (dx !== 0 || dy !== 0) {
                    player.vx = dx * player.speed;
                    player.vy = dy * player.speed;
                    isMoving = true;
                } else {
                    player.vx *= 0.8;
                    player.vy *= 0.8;
                    if (Math.abs(player.vx) < 0.1) player.vx = 0;
                    if (Math.abs(player.vy) < 0.1) player.vy = 0;
                    isMoving = false;
                }

                player.x += player.vx;
                player.y += player.vy;

                // Границы
                player.x = Math.max(0, Math.min(600 - PLAYER_SIZE, player.x));
                player.y = Math.max(0, Math.min(600 - PLAYER_SIZE, player.y));

                // Анимация
                if (isMoving) {
                    frameCount++;
                    if (frameCount >= 10) {
                        frameCount = 0;
                        animFrame = (animFrame + 1) % 3;
                    }
                }

                // Отрисовка
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Фон (сетка)
                ctx.fillStyle = '#2a2f3e';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.translate(
                    (canvas.width - 600) / 2,
                    (canvas.height - 600) / 2
                );

                // Мир
                ctx.fillStyle = '#3a4f3e';
                ctx.fillRect(0, 0, 600, 600);
                
                for (let i = 0; i <= 600; i += 40) {
                    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, 600);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(600, i);
                    ctx.stroke();
                }

                // Персонаж
                let img = isMoving ? images.run[animFrame] : images.idle;
                
                if (img && img.complete && img.naturalHeight > 0) {
                    ctx.drawImage(img, player.x, player.y, PLAYER_SIZE, PLAYER_SIZE);
                } else {
                    // Если картинка не грузится - цветной квадрат
                    ctx.fillStyle = isMoving ? '#44ff44' : '#4444ff';
                    ctx.fillRect(player.x, player.y, PLAYER_SIZE, PLAYER_SIZE);
                    
                    // Показываем статус
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Arial';
                    ctx.fillText('Загрузка...', 10, 20);
                }

                requestAnimationFrame(update);
            }

            // Запуск
            update();

        })();
    </script>
</body>
</html>
